<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Friendship Quiz</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBTlvvGGWKaAsOyQ4zSeJ5aID_eD3nMfkI",
        authDomain: "truth-dare-5a92c.firebaseapp.com",
        projectId: "truth-dare-5a92c",
        storageBucket: "truth-dare-5a92c.firebasestorage.app",
        messagingSenderId: "299104332770",
        appId: "1:299104332770:web:469c2a277ad01e57efa7bb",
        measurementId: "G-NER090QMCZ"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      // Get quizId from URL
      const urlParams = new URLSearchParams(window.location.search);
      const quizId = urlParams.get('quizId');

      // Sample answers
      let quizData = {};

      // Fetch quiz data from Firebase
      function fetchQuizData() {
        get(ref(database, 'quizzes/' + quizId)).then((snapshot) => {
          if (snapshot.exists()) {
            quizData = snapshot.val();
            renderQuiz(quizData);
          }
        });
      }

      // Render quiz for the friend
      function renderQuiz(quizData) {
        const container = document.getElementById('quiz-container');
        quizData.questions.forEach((question, index) => {
          const questionElement = document.createElement('div');
          questionElement.classList.add('question');
          const questionText = document.createElement('p');
          questionText.textContent = question.text;
          questionElement.appendChild(questionText);

          question.options.forEach(option => {
            const optionLabel = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = `q${index}`;
            input.value = option;
            optionLabel.appendChild(input);
            optionLabel.appendChild(document.createTextNode(option));
            questionElement.appendChild(optionLabel);
          });

          container.appendChild(questionElement);
        });
      }

      // Compare and show results
      function submitQuiz() {
        const answers = {};
        let correctCount = 0;
        quizData.questions.forEach((question, index) => {
          const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
          if (selectedOption) {
            answers[question.id] = selectedOption.value;
            if (selectedOption.value === quizData.answers[question.id]) {
              correctCount++;
            }
          }
        });

        // Save friend's answers and show results
        const resultId = push(ref(database, 'responses')).key;
        set(ref(database, 'responses/' + resultId), {
          quizId: quizId,
          answers: answers,
          correctCount: correctCount
        });

        alert(`You got ${correctCount} out of ${quizData.questions.length} correct!`);
      }

      // Fetch quiz data when page loads
      document.addEventListener('DOMContentLoaded', () => {
        fetchQuizData();
      });
    </script>
</head>
<body>
    <h1>Friendship Quiz</h1>
    <div id="quiz-container"></div>
    <button onclick="submitQuiz()">Submit Quiz</button>
</body>
</html>
